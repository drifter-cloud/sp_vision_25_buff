# 1月14日
测打前哨站时，6mm镜头在6m时滤波器已经很难正常工作了。原因是在当前神经网络框架下，四个点抖动导致的armor_yaw变化已经超过了原本装甲板旋转导致的yaw的变化。解决方法也只有从识别器入手，就当前时间节点来看，只能引入时变的roi去优化识别结果。

# 11月27日
很久没有更新了，现在回头看一两个月前的想法还有很多是错误的。  
- 当前自瞄是可以做到自适应小陀螺转速的，即在小陀螺转速变快后云台yaw的摆角会变小。原因则是转速过快后云台的响应已经无法跟上，两帧之间的yaw值最多相差8度还多，而云台8度阶跃的响应普遍大于700ms。
- 由上面这个现象其实可以导出另外一个问题，即**自瞄的帧率**。目前自瞄帧率约为90fps，和强队相比不算是高。而自瞄的帧率其实可以视为一个采样问题，特别是对于滤波器而言，帧率越高意味着这个实际连续的过程被离散化的程度越小。就像是牛顿微积分，dt越来越小，就越来越精准，最终由sigma求和进化为积分。
- 之前测哨兵打前哨站时发现距离在5m左右，将coming与leaving angle设到比较小的值（30度）时，会一直无法进入设计条件。原因则是，目前自瞄只会在识别到装甲板后进行预测，对于静止击打前哨站来说，这个能识别到的区间是定值，也就意味着每次预测的可击打区间也是定值，而这个可击打区间恰好不在两个angle之间。
    > 这个问题的解决思路之一是将两个angle的值从常量写成是distance的函数。需要一些测试获得这个函数的超参数。
- 现在在射击控制中多加了一些对云台到位的判断，即如果last_command.yaw与当前云台的yaw差值过大则认为云台没有执行到位，不进行射击。
    > 我认为这算是一个有风险的操作，相当于做了一个没有反馈的闭环，即云台执行确实没到位的话我们也没有做出相应补偿，而是限制了一些行为——射击。不过在云台执行情况过差时确实也失去了射击的意义，这样看似乎是合理的。之后有可能的话还是改进一下吧😭，当前还是不够鲁棒。

# 11月1日
测试了牢哨兵的自瞄命中率
- 3m 5rad/s 70%
- 3m 10rad/s 40%
- 3m 15rad/s 40%
- 3m 4-8rad/s 30%
- 3m 2-5rad/s 40%
- 3m 8-10rad/s 40%

# 10月23日
ekfpnp能跑，但是发散。最近两周都不太有时间排查原因。  
可能是四个点无法收敛？论文中的实验数据都是20个点起步。

# 10月21日
出新规则了，对自瞄而言几乎都是好消息。  
当前赛季应该可以将自瞄的三大核心：**检测器，观测器，决策器**。都更新迭代一次。

# 10月20日
TODO 一个一键安装环境的脚本

# 10月15日
按照我粗浅的理解，视觉不应该介入实际的**控制过程**。  
既我们给cboard发送的值一定是真值，只应该将电机的各种特性考虑到系统模型当中，而不应该给电控一个“伪真值”使其较好地达到真值

# 10月14日
有一种85%既是当前算法下上限命中率的感觉。  
面对前哨站——一个只要kalman合理收敛即可视为能够精准预测运动的模型，如果电机是理想模型的话，在当前框架下可以达到100%的命中率。  
15%的差距就在于，我们目前并没有对云台进行合理建模，我们不考虑yaw轴的响应时间，只考虑弹丸的飞行时间，对于发弹延时的考虑也欠妥（只在开火时用了，没有在停火时用该时间）  
可能的一条路——**将shoot连续化**，用概率表示。然后设置一个阈值，当大于该阈值后可以shoot。这样做的好处是可以根据很多条件来设置这个概率，比如在装甲板接近leaving_angle时将shoot的值调低。  
shoot的本质是**决策**

# 10月7日
TODO 新增一个模块去判断一下开火。  
当前使用last_command.yaw与command.yaw做判断只会对一帧有效果，需要在judger内置一个状态机来反映一下yaw轴的响应延时  
当前优化前哨站击打的思路较普通的四装甲板车来说基本是不适用的。  
之后必须加上自适应的delta_angle和comming_angle(`aimer`)

# 10月6日
目前打前哨站有70%命中率，但是射频很低  
准备放宽一些射击约束，不依赖tracker的状态进行判断  
修改了判断条件，并且电控优化了yaw轴pid后命中率突破80%🥰

# 10月5日
之前写的跳变就不开火完全是错误的，马上修正。  
打前哨站时，应该在aimpoint.valid为true时就开火  
根据目前滤波器的参数，在一个旋转周期后就可以比较好的收敛，故可通过旋转圈数无反馈（不知是否真的收敛）的去控制开火  
~~TODO 可以对前哨站增加一些额外的**敛散性判断**~~

# 9月30日
思考了下PnP测试的问题，感觉神经网络搭配PnP很难测准，传统识别的话抖动不那么剧烈。  
但是装甲板朝向角改变后distance的改变也太离谱了，想要优化一下.  
或者说当前命中率还可以很大程度上是因为小弹丸在+-10cm内的下坠不太明显，滤波器参数设置正确的话近距离射击的话命中率确实可观  
当前自瞄给我的感觉是全靠**滤波器**在纠正各种偏差、抖动、噪声。如果滤波器参数设置没调好，自瞄大概率G了。并且在英雄上影响巨大

# 9月29日
~~**新写一版针对于前哨站的卡尔曼吧🤯**~~  
cxy的代码可以用了，65%的命中率,只需在现有滤波器上改几个参数效果就比较好,也不必重写了  
**重新考虑下EKFPnP的问题**

# 9月28日
装甲板yaw值相对是准确的，但是distance很不准，或许可以用yaw值去优化distance？ 
> 基于此考虑将EKF的R矩阵distance的那一项从常数修改为了yaw的函数   

当前版本卡尔曼对前哨站效果很差，或许可以会看下23年大作业

# 9月27日
当装甲板跳变时则不开火，感觉可以提升一点命中率  
感觉手眼标定的重复误差有些大，需要看看原理。统计了下论文实验中使用图片的数量:
>   CALIB_HAND_EYE_TSAI(12组)        
    CALIB_HAND_EYE_PARK(20~30组后收敛,总数据90组)  
    CALIB_HAND_EYE_HORAUD    
    CALIB_HAND_EYE_ANDREFF(33组)    
    CALIB_HAND_EYE_DANIILIDIS(20组)

# 9月26日
添加了该更新日志，不定时更新一些想法和测试记录